---           
layout: post
title: SOU Under Attack from Malware
date: 2008-11-17 22:33:27 UTC
updated: 2008-11-17 22:33:27 UTC
comments: false
categories: 
---
[![](http://1.bp.blogspot.com/_CqsRlf7vT4Y/SSHxMixn68I/AAAAAAAAACc/_HEB5V02tRI/s320/n177102107_30536120_8136.jpg)][0]  
Today, Monday was supposed to be a calm morning. I received the usual pages from my installation of Zenoss Network Monitoring software that David Whipp our Network Engineer had rebooted a couple servers. So I took my time walking to my office building, stopping off at Starbucks for the usual 16oz Vanilla Latte. Today I ordered a tall latte though which is not \>= 16oz. I don't understand why they can't just post the number of ounces in relation to drink size. Instead they have to put Tall, Grande, and Venti, but I digress.  

On arriving at work I check my e-mail and replied to a couple before Paul (my direct supervisor) came in letting me know that we were having trouble with DNS. Clients in our subnet 140.211.91.0/24 were being leased erroneous DNS server addresses instead of our typical primary ns.sou.edu and ns2.sou.edu they were receiving 88.255.112.36 and 85.255.112.41\. I quickly checked our DHCP servers scope options and access logs to ensure that it had not been compromised. The DHCP server was fine. Next, I proceeded to fire up a copy of Wireshark to look for rogue DHCP servers. It was at that point I noticed an unusual amount of DHCP ACKS and informs from an address that wasn't our DHCP server. In order to better track down what segment of our building the culprit was in I knew I would need to set up a SPAN port.  

My initial instinct was to set up the span on our core router a CAT6509 however, this proved to be to high level to see anything other than DHCP Discovers and Informs because the infected machine was probably connected to the IDF switches one tier down. There were three possible IDF switches the client could have been connected to so David set up a span port on all three switches. Using my own Macbook, Cory's Macbook, and Daniel's XPS running Ubuntu we each started a capture. It was at this point we were all simply sitting in a wire closet watching for DHCP ACKS.  

After some waiting, without a latte I might add our search came to fruition. We noticed that a specific client was ACKING before our real DHCP server on the switch that runs most of the second floor for our building. This includes mostly College of Arts and Sciences and Computer Science Faculty. I personally visited each machine looking for a match to the IP address and could find none. At this point we were desperate. The next step was to break out the toner and do a trace all the way to the upstairs closet. We found a machine tucked away in a secluded location. More on that later....

www.andrewkrug.com E-Mail Comments to andrewkrug@gmail.com

[0]: http://1.bp.blogspot.com/_CqsRlf7vT4Y/SSHxMixn68I/AAAAAAAAACc/_HEB5V02tRI/s1600-h/n177102107_30536120_8136.jpg